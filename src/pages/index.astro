---
import Layout from "../layouts/Layout.astro";
import Analytics from "@vercel/analytics/astro";
import { createClient } from "@supabase/supabase-js";

export const prerender = false;

// Supabase (safe for read-only public data using ANON key)
const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;

if (!supabaseUrl || !supabaseAnonKey) {
  throw new Error("Missing PUBLIC_SUPABASE_URL or PUBLIC_SUPABASE_ANON_KEY");
}

const supabase = createClient(supabaseUrl, supabaseAnonKey);

// Pull featured businesses (adjust filters to your preference)
const { data: featuredBusinesses, error: featuredError } = await supabase
  .from("businesses")
  .select("id, name, category, description, city, state, website, phone")
  .eq("featured", true)
  // If you want to only show verified businesses on the homepage, uncomment:
  // .eq("verified", true)
  .order("promoted_at", { ascending: false, nullsFirst: false })
  .order("created_at", { ascending: false })
  .limit(4);

if (featuredError) {
  console.error("Featured fetch error:", featuredError);
}
---

<Layout
  title="VantaJax • Find Black-owned businesses in Jacksonville, FL"
  description="VantaJax helps you find and support Black-owned businesses across Jacksonville, Florida."
  fullWidth={true}
>
  <!-- HERO (centered launcher, no search) -->
  <section class="px-4 pt-16 pb-10">
    <div class="mx-auto w-full max-w-4xl">
      <div class="mx-auto max-w-4xl rounded-3xl border border-slate-200 bg-white shadow-sm">
        <div class="px-6 py-10 sm:px-10 sm:py-12 text-center">
          <p class="text-[11px] font-semibold uppercase tracking-[0.25em] text-purple-700">
            VantaJax • Jacksonville, FL
          </p>

          <h1 class="mt-3 text-3xl sm:text-5xl font-semibold tracking-tight text-slate-900">
            Find Black-owned businesses in Jacksonville.
          </h1>

          <p class="mt-4 text-sm sm:text-base text-slate-600 mx-auto max-w-4xl">
            VantaJax is a curated local directory to help you discover Black-owned spots and professionals.
            Browse the directory, then suggest missing businesses to help the city stay up to date.
          </p>

          <div class="mt-7 flex flex-wrap items-center justify-center gap-3">
            <a
              href="/businesses"
              class="inline-flex items-center justify-center rounded-full bg-purple-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-purple-700"
            >
              Browse directory
            </a>

            <a
              href="/suggest-business"
              class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-6 py-3 text-sm font-semibold text-slate-800 hover:bg-slate-50"
            >
              Suggest a business
            </a>
          </div>

          <div class="mt-7 flex flex-wrap items-center justify-center gap-2 text-[12px] text-slate-600">
            <span class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1">Jacksonville-first</span>
            <span class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1">Community-sourced</span>
            <span class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1">Built for quick discovery</span>
          </div>

          <div class="mt-6 text-[12px] text-slate-500">
            Not sure what this is?{" "}
            <a href="/about" class="font-semibold text-purple-700 hover:text-purple-800">
              Learn how VantaJax works →
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FEATURED (from Supabase, editorial highlights) -->
<section class="px-4 pb-10">
  <div class="mx-auto w-full max-w-4xl">
    <div class="text-center">
      <h2 class="text-xl sm:text-4xl font-semibold text-slate-900">
        Featured highlights
      </h2>
      <p class="mt-3 text-sm text-slate-600 mx-auto max-w-4xl">
        A few spots worth checking out right now — hand-picked from the directory.
      </p>
    </div>

    {featuredError ? (
      <div class="mt-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm text-center">
        <p class="text-sm font-semibold text-slate-900">Featured businesses are temporarily unavailable.</p>
        <p class="mt-2 text-sm text-slate-600">Try refreshing, or browse the full directory instead.</p>
        <div class="mt-4">
          <a
            href="/businesses"
            class="inline-flex items-center justify-center rounded-full bg-purple-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-purple-700"
          >
            Browse directory
          </a>
        </div>
      </div>
    ) : (featuredBusinesses && featuredBusinesses.length > 0) ? (
      <div class="mt-8 space-y-4">
        {featuredBusinesses.map((b) => (
          <a
            href={`/business/${b.id}`}
            class="group block rounded-2xl border border-slate-200 bg-white p-6 shadow-sm hover:bg-slate-50"
          >
            {/* Title centered */}
            <div class="text-center">
              <h3 class="text-base sm:text-lg font-semibold text-slate-900 group-hover:text-purple-700">
                {b.name}
              </h3>

              {/* Metadata centered (category + city/state) */}
              <p class="mt-2 text-[12px] text-slate-600">
                {b.category}
                {b.city ? ` • ${b.city}${b.state ? `, ${b.state}` : ""}` : ""}
              </p>
            </div>

            {/* Description left-aligned for readability */}
            <p class="mt-4 text-sm text-slate-600 text-center leading-relaxed">
              {b.description ? b.description : "View listing details in the directory."}
            </p>

            <div class="mt-5 text-center">
              <span class="text-sm font-semibold text-purple-700">
                View details →
              </span>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="mt-6 rounded-2xl border border-slate-200 bg-white p-6 shadow-sm text-center">
        <p class="text-sm font-semibold text-slate-900">No featured businesses yet.</p>
        <p class="mt-2 text-sm text-slate-600">
          Mark a few businesses as <span class="font-semibold">featured</span> in Supabase to have them appear here.
        </p>
        <div class="mt-4 flex flex-wrap justify-center gap-3">
          <a
            href="/businesses"
            class="inline-flex items-center justify-center rounded-full bg-purple-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-purple-700"
          >
            Browse directory
          </a>
          <a
            href="/suggest-business"
            class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-6 py-3 text-sm font-semibold text-slate-800 hover:bg-slate-50"
          >
            Suggest a business
          </a>
        </div>
      </div>
    )}

    <div class="mt-8 text-center">
      <a
        href="/businesses"
        class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-6 py-3 text-sm font-semibold text-slate-800 hover:bg-slate-50"
      >
        View all businesses →
      </a>
    </div>
  </div>
</section>


  <!-- HOW IT WORKS (centered + clearer) -->
  <section class="px-4 py-12 bg-slate-50 border-y border-slate-100">
    <div class="mx-auto w-full max-w-4xl">
      <div class="mx-auto max-w-4xl text-center">
        <h2 class="text-xl sm:text-2xl font-semibold text-slate-900">
          How it works
        </h2>
        <p class="mt-2 text-sm text-slate-600 mx-auto max-w-4xl">
          VantaJax is meant to be simple: discover businesses, get the info you need, and keep the directory growing.
        </p>

        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-left">
          <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <p class="text-[12px] font-semibold text-purple-700">Step 1</p>
            <h3 class="mt-1 font-semibold text-slate-900">Browse</h3>
            <p class="mt-2 text-sm text-slate-600">
              Explore businesses and professionals on the directory page using filters.
            </p>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <p class="text-[12px] font-semibold text-purple-700">Step 2</p>
            <h3 class="mt-1 font-semibold text-slate-900">Choose</h3>
            <p class="mt-2 text-sm text-slate-600">
              Listings focus on clarity: what they offer, where they’re located, and how to reach them.
            </p>
          </div>

          <div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <p class="text-[12px] font-semibold text-purple-700">Step 3</p>
            <h3 class="mt-1 font-semibold text-slate-900">Suggest</h3>
            <p class="mt-2 text-sm text-slate-600">
              If something’s missing, submit it — that’s how VantaJax stays accurate.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA (centered) -->
  <section class="px-4 py-14">
    <div class="mx-auto w-full max-w-6xl">
      <div class="mx-auto max-w-4xl rounded-3xl border border-slate-200 bg-white p-8 sm:p-10 shadow-sm text-center">
        <h2 class="text-lg sm:text-xl font-semibold text-slate-900">
          Know a business that should be here?
        </h2>
        <p class="mt-2 text-sm text-slate-600 mx-auto max-w-4xl">
          Suggesting a business takes under a minute and helps keep the directory useful for everyone.
        </p>

        <div class="mt-6 flex flex-wrap items-center justify-center gap-3">
          <a
            href="/suggest-business"
            class="inline-flex items-center justify-center rounded-full bg-purple-600 px-6 py-3 text-sm font-semibold text-white shadow-sm hover:bg-purple-700"
          >
            Suggest a business
          </a>
          <a
            href="/businesses"
            class="inline-flex items-center justify-center rounded-full border border-slate-300 bg-white px-6 py-3 text-sm font-semibold text-slate-800 hover:bg-slate-50"
          >
            Browse directory
          </a>
        </div>
      </div>
    </div>
  </section>

  <Analytics />
</Layout>
