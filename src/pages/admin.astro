---
import '../styles/global.css';
import Analytics from '@vercel/analytics/astro';
import AdminDashboard from '../components/AdminDashboard';
import { createClient } from '@supabase/supabase-js';

export const prerender = false; // this page should be server-rendered, not static

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
const serviceKey = import.meta.env.SUPABASE_SERVICE_ROLE_KEY;

if (!supabaseUrl || !serviceKey) {
  console.warn('Supabase admin credentials are missing. Check env vars.');
}

const supabase = createClient(supabaseUrl!, serviceKey || '');

const { data: suggestions = [], error } =
  supabaseUrl && serviceKey
    ? await supabase
        .from('business_suggestions')
        .select('*')
        .order('created_at', { ascending: false })
    : { data: [], error: null };

if (error) {
  console.error('Error loading suggestions for admin:', error);
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Admin • Vanta Black-Owned Radar</title>
  </head>
  <body class="min-h-screen bg-black text-slate-50">
    <div class="relative min-h-screen overflow-hidden">
      <div class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(147,51,234,0.35),_transparent_55%),_radial-gradient(circle_at_bottom,_rgba(59,7,100,0.6),_transparent_55%)] opacity-80" />

      <main class="relative z-10 flex min-h-screen items-center justify-center px-4 py-10">
        <div class="w-full max-w-5xl rounded-3xl border border-purple-900/60 bg-black/80 px-5 py-8 sm:px-8 sm:py-10 shadow-[0_0_60px_rgba(168,85,247,0.35)]">
          <header class="mb-6 flex items-center justify-between gap-3">
            <div>
              <p class="text-[11px] font-semibold uppercase tracking-[0.25em] text-purple-300/80">
                Admin
              </p>
              <h1 class="mt-2 text-2xl sm:text-3xl font-bold tracking-tight">
                Business suggestions
              </h1>
              <p class="mt-1 text-[11px] sm:text-xs text-slate-400">
                Internal view for reviewing and promoting suggestions into the main directory.
                This page is not meant to be public.
              </p>
            </div>
            <a
              href="/"
              class="text-[11px] text-purple-300 underline underline-offset-2 decoration-purple-400/80 hover:text-purple-200"
            >
              ← Back to search
            </a>
          </header>

          <AdminDashboard client:load suggestions={suggestions} />
        </div>
      </main>
    </div>

    <Analytics />
  </body>
</html>
